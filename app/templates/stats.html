{% extends "budget_base.html"%}
{% block title %}Stats Page{% endblock %}

{% block content %} 

<h1>Hello {{user.name}}</h1>

{% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for msg in messages %}
                <p>{{msg}}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}

{% if active_expenses or inactive_expenses %}
    <p>Total Balance: {{lifetime_stats["Balance"]}}</p>
    <p>Total Earnings: {{lifetime_stats["Earnings"]}}</p>
    <p>Total Transferred: {{lifetime_stats["Transferred"]}}</p>
    <p>Total Spent: {{lifetime_stats["Spendings"]}}</p>
    <p>Total Savings: {{lifetime_stats["Savings"]}}</p>


{% endif %}

{% if active_expenses %}
    <h1>Active Expenses:</h1>
    {% for expense_id in active_expenses %}

        <h2>{{active_expenses[expense_id]["name"]}}</h2>
        {% set earned = active_expenses[expense_id]["earning"]%}
        {% set spent = active_expenses[expense_id]["spending"]%}
        {% set saved = active_expenses[expense_id]["saving"]%}
        {% set balance = active_expenses[expense_id]["balance"]%}
        {% set transferred = active_expenses[expense_id]["transferred"]%}

        <table class="table">
            <thead>
                <tr>
                    <th>Total Balance</th>
                    <th> Earned</th>
                    <th> Transferred</th>
                    <th> Spent</th>
                    <th> Remaining</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td>${{balance}}</td>
                    <td>${{earned}}</td>
                    <td>${{transferred}}</td>
                    <td>${{spent}}</td>
                    <td>${{saved}}</td>
                </tr>
            </tbody>

        </table>

        
        {% if earned == 0 %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-secondary progress-bar-striped progress-bar-animated"
                    role="progressbar"
                    style="width: 100%">
                    N/A
                </div>
            </div>


        {% elif spent >=earned %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-danger" role="progressbar" style="width: 100%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Spent: 100%</div>
            </div>

        {% elif saved == 0 %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar " role="progressbar" style="width: 100%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">Saved: 0%</div>
            </div>

        {% else %}
            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-danger" role="progressbar" style="width: {{active_expenses[expense_id]['spending_percent']}}%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Spent: {{active_expenses[expense_id]['spending_percent']}}%</div>
                <div class="progress-bar bg-success" role="progressbar" style="width: {{active_expenses[expense_id]['saving_percent']}}%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">Saved: {{active_expenses[expense_id]['saving_percent']}}%</div>
            </div>

        {% endif %}

    {% endfor%}

{% endif %}


{% if inactive_expenses%}
    <h1>Archived Expenses:</h1>
    {% for expense_id in inactive_expenses %}

        <h2>{{inactive_expenses[expense_id]["name"]}}</h2>
        {% set earned = inactive_expenses[expense_id]["earning"]%}
        {% set spent = inactive_expenses[expense_id]["spending"]%}
        {% set saved = inactive_expenses[expense_id]["saving"]%}
        {% set balance = inactive_expenses[expense_id]["balance"]%}
        {% set transferred = inactive_expenses[expense_id]["transferred"]%}

        <table class="table">
            <thead>
                <tr>
                    <th>Total Balance</th>
                    <th> Earned</th>
                    <th> Transferred</th>
                    <th> Spent</th>
                    <th> Remaining</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <form action="#" method="POST">
                        <td>${{balance}}</td>
                        <td>${{earned}}</td>
                        <td>${{transferred}}</td>
                        <td>${{spent}}</td>
                        <td>${{saved}}</td>
                    </form>
                    
                </tr>
            </tbody>

        </table>

        
        {% if earned == 0 %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-secondary progress-bar-striped progress-bar-animated"
                    role="progressbar"
                    style="width: 100%">
                    N/A
                </div>
            </div>


        {% elif spent >=earned %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-danger" role="progressbar" style="width: 100%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Spent: 100%</div>
            </div>

        {% elif saved == 0 %}

            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar " role="progressbar" style="width: 100%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">Saved: 0%</div>
            </div>

        {% else %}
            <div class="progress" style="width: 95%; margin: 0 auto; height: 40px; font-size: 18px;">
                <div class="progress-bar bg-danger" role="progressbar" style="width: {{inactive_expenses[expense_id]['spending_percent']}}%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Spent: {{inactive_expenses[expense_id]['spending_percent']}}%</div>
                <div class="progress-bar bg-success" role="progressbar" style="width: {{inactive_expenses[expense_id]['saving_percent']}}%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">Saved: {{inactive_expenses[expense_id]['saving_percent']}}%</div>
            </div>

        {% endif %}

    {% endfor%}

{% endif %}

{% if spending %}
    <h1>Spending Log</h1>
    <table class="table">
        <thead>
            <tr>
                <th>Expense</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Reasoning</th>
            </tr>
            
        </thead>

        <tbody>
            {% for spent in spending %}
                    <tr>
                        <td>{{spent.expense_name}}</td>
                        <td>{{spent.date}}</td>
                        <td>{{spent.amount}}</td>
                        <td>{{spent.reasoning}}</td>
                    </tr>
                    
            {% endfor %}
        </tbody>

    </table>
{% endif %}

{% endblock %}