{% extends "budget_base.html" %}
{% block title%} ENTRY VIEWING {% endblock%}

{% block content %}
<h1>DATE: {{entry.date}}</h1>

{% set ns = namespace(total_spent=0) %}

{% for spent in spending %}
    {% if not spent.credit_status %}
        {% set ns.total_spent = ns.total_spent + spent.amount %}
    {% endif %}
{% endfor %}

<h1>CURRENT INCOME: ${{ entry.income }}</h1>
<h1>TOTAL SPENT: ${{ ns.total_spent }}</h1>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for msg in messages %}
      <p>{{msg}}</p>
    {% endfor %}
  {% endif %}
{% endwith %}

<form action="/add_income/{{entry.id}}" method="POST">
    <p><input type="number" step="0.01" name="income" placeholder="Enter income"></p>
    <p><button type="submit">Submit</button></p>

</form>

<table class="table">
    <thead>
        <tr>
            <th>Expense</th>
            <th>Allocated</th>
            <th>Leftover Cash</th>
            <th>Spent</th>
            <th>Saved</th>
        </tr>
    </thead>

    <tbody>
        {% for snapshot in snapshots %}
            {% if snapshot %}
                <tr>
                    <td>{{snapshot.expense_name}}</td>
                    <td>${{snapshot.expense_earnings}}</td>
                    <td>${{est_balance[snapshot]}}</td>
                    <td>
                        <form action="/add_spending/{{snapshot.id}}" method="POST">
                            <p><input type="number" step="0.01" placeholder="Total Spent: ${{snapshot.total_spending}}" name="spending" required></p>
                            <p><input type="text" placeholder="Add Note" name="reasoning" required></p> 
                            <button type="submit" class="btn btn-primary">Debit</button> 
                            <button type="submit" class="btn btn-primary" formaction="/add_credit/{{snapshot.id}}">Credit</button>

                        </form>

                    </td>
                    <td>${{snapshot.get_savings()}}</td>

                </tr>

            {% endif %}
        {% endfor%}
    </tbody>

</table>

{% if spending %}
    <h1>Spending Log</h1>
    <table class="table">
        <thead>
            <tr>
                <th>Expense</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Reasoning</th>
                <th>Action</th>
            </tr>
            
        </thead>

        <tbody>
            {% for spent in spending %}
                    <tr>
                        <td>{{spent.expense_name}}</td>
                        <td>{{spent.date}}</td>
                        <form action="/edit_spending/{{spent.id}}" method="POST">
                            <td><input type="number" min="0" placeholder="${{spent.amount}}" name="amount" required>
                                <button class="btn btn-primary" type="submit">Save</button>
                            </td>
                        </form>
                        
                        <td>{{spent.reasoning}}</td>
                        <td>
                            <form action="/delete_spending/{{spent.id}}" method="POST">
                                <button class="btn btn-danger" type="submit">Delete</button>
                                {% if spent.credit_status %}
                                    <button class="btn btn-success" type="submit" formaction="/pay_credit/{{spent.id}}">Pay Credit Balance</button>

                                {% endif %}
                            </form>
                            
                        </td>
                    </tr>
                    
            {% endfor %}
        </tbody>

    </table>
{% endif %}




{% endblock %}

{% block scripts%}

{% endblock %}