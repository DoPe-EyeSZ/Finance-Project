{% extends "budget_base.html" %}
{% block title%} Charts {% endblock%}

{% block content %}

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for msg in messages %}
          <div class="flash-message">{{msg}}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}


    <div class="chart-container">
        <div id="chart"></div>
    </div>

    <div class="chart-container">
        <div id="expense_bar"></div>
    </div>

    <div class="chart-container">
        <div id="pie"></div>
        <h2>work on this laters</h2>
    </div>



{% endblock %}



{% block scripts%}
    <script>
        fetch("/spending_income_data").then(response => response.json()).then(data=> {
            const income = {
                x: data.dates_income,
                y: data.income,
                type: "scatter",
                mode: "lines+markers",
                name: "Income",
                line: {
                    color: '#5fb878',  // Green line
                    width: 3
                },
                marker: {
                    color: '#5fb878',  // Green markers
                    size: 8
                },
                text: data.income.map(val => `$${val}`),  // Show income values
                hovertemplate: '<b>%{text}</b><br>Date: %{x}<extra></extra>'  // Display on hover
            };

            const spending = {
                x: data.dates_spending,
                y: data.spending,
                type: "scatter",
                mode: "lines+markers",
                name: "Spending",
                line: {
                    color:"#e87373",
                    width: 3
                },
                marker: {
                    color: "#e87373",
                    size: 8
                },
                text: data.spending.map(val => `$${val}`),  
                hovertemplate: '<b>%{text}</b><br>Date: %{x}<extra></extra>'  // Display on hover
            };
            

            const layout = {
                title: "Income/Spending Over Time",
                xaxis: {title: "Dates"},
                yaxis: {title: "Cash ($)"},
                TransitionEvent
            };

            Plotly.newPlot("chart", [income, spending], layout, {displayModeBar: false});
        });



        fetch("/all_expense_data").then(response => response.json()).then(data=>{
            const earned = {
                x: data.expenses,
                y: data.total_earned,
                name: "Total Earnings",
                type: "bar",
                marker: { color: "#5fb878" },
                text: data.total_earned.map(val => `$${val}`),
                textposition: "auto",
                hoverinfo: "none",
                hovertemplate: '<b>Total Earnings</b><br> $%{y}<extra></extra>'
            };

            const spending = {
                x: data.expenses,
                y: data.total_spent,
                name: "Total Spending",
                type: "bar",
                marker: { color: "#e87373" },
                text: data.total_spent.map(val => `$${val}`),
                textposition: "auto",
                hoverinfo: "y+name",
                hovertemplate: '<b>Total Spent</b><br> $%{y}<extra></extra>'
            };

            const savings = {
                x: data.expenses,
                y: data.total_saved,
                name: "Total Savings",
                type: "bar",
                marker: { color: "#3AAFA9" },
                text: data.total_saved.map(val => `$${val}`),
                textposition: "auto",
                hoverinfo: "y+name",
                hovertemplate: '<b>Total Savings</b><br> $%{y}<extra></extra>'
            };


            const layout = {
                barmode: "group",
                title: "Expense Overview"
            };

            Plotly.newPlot("expense_bar", [earned, spending, savings], layout, {displayModeBar: false})
        });

        fetch("/overview_data").then(response => response.json()).then(data => {
            const values = [{
                type: "pie",
                values: data.all_data,
                labels: data.data_labels,
                marker: {
                    colors: [ '#e87373', '#5fb878']
                },
                textinfo: "label+percent",
                textposition: "outside",
                automargin: true,
                textfont: {
                    color: '#e0e0e0',
                    size: 14
                },
                hovertemplate: '<b>%{label}</b><br>$%{value}<br>%{percent}<extra></extra>'
            }];
            
            const layout = {
                height: 500,
                width: 500,
                margin: {t: 40, b: 40, l: 40, r: 40},
                showlegend: false,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: '#e0e0e0',
                    family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif'
                }
            };
            
            Plotly.newPlot('pie', values, layout, {displayModeBar: false});
        });
    </script>

{% endblock %}